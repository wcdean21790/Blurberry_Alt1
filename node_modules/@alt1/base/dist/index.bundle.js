!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["@alt1/base"]=e():t.A1lib=e()}("undefined"!=typeof self?self:this,(()=>(()=>{
"use strict";var t={d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{
"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Alt1Error:()=>M,ImageData:()=>u,ImageDetect:()=>r,
ImageStreamReader:()=>X,ImgRef:()=>n,ImgRefBind:()=>h,ImgRefCtx:()=>o,ImgRefData:()=>s,NoAlt1Error:()=>D,NodePolyfill:()=>i,PasteInput:()=>a,Rect:()=>d,addResizeElement:()=>_,capture:()=>S,captureAsync:()=>Q,captureHold:()=>U,captureHoldFullRs:()=>T,
captureHoldScreen:()=>F,captureMultiAsync:()=>Z,captureStream:()=>tt,decodeImageString:()=>k,encodeImageString:()=>N,getMousePosition:()=>V,getdisplaybounds:()=>O,hasAlt1:()=>A,hasAlt1Version:()=>J,identifyApp:()=>z,mixColor:()=>H,
newestversion:()=>E,on:()=>Y,once:()=>K,openbrowser:()=>L,removeListener:()=>$,requireAlt1:()=>P,resetEnvironment:()=>G,skinName:()=>R,transferImageData:()=>j,unmixColor:()=>q});var i={};t.r(i),t.d(i,{createCanvas:()=>v,imageDataFromBase64:()=>x,
imageDataFromBuffer:()=>I,imageDataToDrawable:()=>p,imageDataToFileBytes:()=>b,polyfillRequire:()=>c,requireElectronCommon:()=>w,requireNodeCanvas:()=>m,requireSharp:()=>g});var r={};t.r(r),t.d(r,{ImageDataSet:()=>gt,asyncMap:()=>lt,
clearPngColorspace:()=>ot,coldif:()=>ft,findSubbuffer:()=>st,findSubimage:()=>ht,imageDataFromBase64:()=>rt,imageDataFromFileBuffer:()=>at,imageDataFromUrl:()=>it,isPngBuffer:()=>nt,simpleCompare:()=>dt,simpleCompareRMSE:()=>ut,webpackImages:()=>ct})
;var a={};t.r(a),t.d(a,{fileDialog:()=>At,lastref:()=>yt,listen:()=>bt,start:()=>Et,startDragNDrop:()=>Mt,triggerPaste:()=>It,unlisten:()=>xt});class n{constructor(t,e,i,r){this.t="none",this.x=t,this.y=e,this.width=i,this.height=r}
read(t=0,e=0,i=this.width,r=this.height){throw new Error("This imgref ("+this.t+") does not support toData")}findSubimage(t,e=0,i=0,r=this.width,a=this.height){return ht(this,t,e,i,r,a)}toData(t=this.x,e=this.y,i=this.width,r=this.height){
return this.read(t-this.x,e-this.y,i,r)}containsArea(t){return this.x<=t.x&&this.y<=t.y&&this.x+this.width>=t.x+t.width&&this.y+this.height>=t.y+t.height}}class o extends n{constructor(t,e=0,i=0){
if(t instanceof CanvasRenderingContext2D)super(e,i,t.canvas.width,t.canvas.height),this.ctx=t;else{super(e,i,t.width,t.height);var r=t instanceof HTMLCanvasElement?t:t.toCanvas();this.ctx=r.getContext("2d")}this.t="ctx"}
read(t=0,e=0,i=this.width,r=this.height){return this.ctx.getImageData(t,e,i,r)}}class h extends n{constructor(t,e=0,i=0,r=0,a=0){super(e,i,r,a),this.handle=t,this.t="bind"}read(t=0,e=0,i=this.width,r=this.height){return j(this.handle,t,e,i,r)}}
class s extends n{constructor(t,e=0,i=0){super(e,i,t.width,t.height),this.buf=t,this.t="data"}read(t=0,e=0,i=this.width,r=this.height){if(0==t&&0==e&&i==this.width&&r==this.height)return this.buf
;for(var a=new ImageData(i,r),n=e;n<e+r;n++)for(var o=t;o<t+i;o++){var h=4*(o-t)+(n-e)*i*4,s=4*o+4*n*this.buf.width;a.data[h]=this.buf.data[s],a.data[h+1]=this.buf.data[s+1],a.data[h+2]=this.buf.data[s+2],a.data[h+3]=this.buf.data[s+3]}return a}}
class d{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}static fromArgs(...t){if("object"==typeof t[0])return new d(t[0].x,t[0].y,t[0].width,t[0].height);if("number"==typeof t[0]&&t.length>=4)return new d(t[0],t[1],t[2],t[3])
;throw new Error("invalid rect args")}union(t){var e=Math.min(this.x,t.x),i=Math.min(this.y,t.y);return this.width=Math.max(this.x+this.width,t.x+t.width)-e,this.height=Math.max(this.y+this.height,t.y+t.height)-i,this.x=e,this.y=i,this}
includePoint(t,e){this.union(new d(t,e,0,0))}inflate(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}intersect(t){this.x<t.x&&(this.width-=t.x-this.x,this.x=t.x),this.y<t.y&&(this.height-=t.y-this.y,this.y=t.y),
this.width=Math.min(this.x+this.width,t.x+t.width)-this.x,this.height=Math.min(this.y+this.height,t.y+t.height)-this.y,(this.width<=0||this.height<=0)&&(this.width=0,this.height=0)}overlaps(t){
return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}contains(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height}containsPoint(t,e){
return this.x<=t&&this.x+this.width>t&&this.y<=e&&this.y+this.height>e}}var u,f=function(t,e,i,r){return new(i||(i=Promise))((function(a,n){function o(t){try{s(r.next(t))}catch(t){n(t)}}function h(t){try{s(r.throw(t))}catch(t){n(t)}}function s(t){
var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,h)}s((r=r.apply(t,e||[])).next())}))},l=null;function c(t){l=t}function g(){try{return l?l("sharp"):require("sharp")}catch(t){}return null}function m(){g();try{
return l?l("canvas"):require("canvas")}catch(t){}return null}function w(){try{return l?l("electron/common"):require("electron/common")}catch(t){}return null}function p(t){let e=m()
;if(!e)throw new Error("couldn't find built-in canvas or the module 'canvas'");return new e.ImageData(t.data,t.width,t.height)}function v(t,e){let i=m();if(!i)throw new Error("couldn't find built-in canvas or the module 'canvas'")
;return i.createCanvas(t,e)}function y(t){for(let e=0;e<t.length;e+=4){let i=t[e+2];t[e+2]=t[e+0],t[e+0]=i}}function b(t,e,i){return f(this,void 0,void 0,(function*(){var r,a;if(r=w()){
let e=r.nativeImage,i=Buffer.from(t.data.slice(t.data.byteOffset,t.data.byteLength));return y(i),e.createFromBitmap(i,{width:t.width,height:t.height}).toPNG()}if(a=g()){let r=a(Buffer.from(t.data.buffer),{raw:{width:t.width,height:t.height,channels:4
}});if("image/png"==e)r.png();else{if("image/webp"!=e)throw new Error("unknown image format: "+e);var n={quality:80};"number"==typeof i&&(n.quality=100*i),r.webp(n)}return yield r.toBuffer({resolveWithObject:!1}).buffer}
throw new Error("coulnd't find build-in image compression methods or the module 'electron/common' or 'sharp'")}))}function x(t){return I(Buffer.from(t,"base64"))}function I(t){return f(this,void 0,void 0,(function*(){var e,i;if(ot(t),e=w()){
let i=e.nativeImage.createFromBuffer(t),r=i.toBitmap(),a=i.getSize(),n=new Uint8ClampedArray(r.buffer,r.byteOffset,r.byteLength);return y(n),new u(n,a.width,a.height)}if(i=m())return new Promise(((e,r)=>{let a=new i.Image;a.onerror=r,a.onload=()=>{
var t=i.createCanvas(a.naturalWidth,a.naturalHeight).getContext("2d");t.drawImage(a,0,0);var r=t.getImageData(0,0,a.naturalWidth,a.naturalHeight);e(new u(r.data,r.width,r.height))},a.src=Buffer.from(t.buffer,t.byteOffset,t.byteLength)}))
;throw new Error("couldn't find built-in canvas, module 'electron/common' or the module 'canvas'")}))}!function(){var t="undefined"!=typeof self?self:"undefined"!=typeof global?global:null,e=void 0===t.ImageData||void 0===t.document,i=e;if(!e){
t.ImageData;try{let e=new Uint8ClampedArray(4);e[0]=1;let r=new t.ImageData(e,1,1);i=1!=r.data[0]}catch(t){i=!0}}if(i){var r=function(){var t=0,r=arguments[t]instanceof Uint8ClampedArray?arguments[t++]:null,a=arguments[t++],n=arguments[t++]
;if(e)r||(r=new Uint8ClampedArray(a*n*4)),this.width=a,this.height=n,this.data=r;else if(i){var o=document.createElement("canvas");o.width=a,o.height=n;var h=o.getContext("2d").createImageData(a,n);return r&&h.data.set(r),h}}
;e||(r.prototype=t.ImageData.prototype),t.ImageData=r,u=r}else u=t.ImageData}(),u.prototype.toDrawableData=function(){return"undefined"==typeof document?p(this):this},u.prototype.putImageData=function(t,e,i){
for(var r=0;r<t.width;r++)for(var a=0;a<t.height;a++){var n=4*(r+e)+4*(a+i)*this.width,o=4*r+4*a*t.width;this.data[n]=t.data[o],this.data[n+1]=t.data[o+1],this.data[n+2]=t.data[o+2],this.data[n+3]=t.data[o+3]}},u.prototype.pixelOffset=function(t,e){
return 4*t+e*this.width*4},u.prototype.getPixelHash=function(t){t||(t=new d(0,0,this.width,this.height));for(var e=0,i=t.x;i<t.x+t.width;i++)for(var r=t.y;r<t.y+t.height;r++){var a=4*i+4*r*this.width
;e=((e=((e=((e=(e<<5)-e+this.data[a]|0)<<5)-e+this.data[a+1]|0)<<5)-e+this.data[a+2]|0)<<5)-e+this.data[a+3]|0}return e},u.prototype.clone=function(t){return this.toImage(t).getContext("2d").getImageData(0,0,t.width,t.height)},
u.prototype.show=function(t=5,e=5,i=1){if("undefined"!=typeof document){for(var r=document.getElementsByClassName("debugimage");r.length>u.prototype.show.maxImages;)r[0].remove();var a=this.toImage();return a.classList.add("debugimage"),
a.style.position="absolute",a.style.zIndex="1000",a.style.left=t/i+"px",a.style.top=e/i+"px",a.style.background="purple",a.style.cursor="pointer",a.style.imageRendering="pixelated",a.style.outline="1px solid #0f0",
a.style.width=(1==this.width?100:this.width)*i+"px",a.style.height=(1==this.height?100:this.height)*i+"px",a.onclick=function(){a.remove()},document.body.appendChild(a),a}console.error("need a document to show an imagedata object")},
u.prototype.show.maxImages=10,u.prototype.toImage=function(t){if(t||(t=new d(0,0,this.width,this.height)),"undefined"!=typeof document){var e=document.createElement("canvas");e.width=t.width,e.height=t.height}else e=v(t.width,t.height)
;return e.getContext("2d").putImageData(this.toDrawableData(),-t.x,-t.y),e},u.prototype.getPixel=function(t,e){var i=4*t+4*e*this.width;return[this.data[i],this.data[i+1],this.data[i+2],this.data[i+3]]},u.prototype.getPixelValueSum=function(t,e){
var i=4*t+4*e*this.width;return this.data[i]+this.data[i+1]+this.data[i+2]},u.prototype.getPixelInt=function(t,e){var i=4*t+4*e*this.width;return(this.data[i+3]<<24)+(this.data[i+0]<<16)+(this.data[i+1]<<8)+(this.data[i+2]<<0)},
u.prototype.getColorDifference=function(t,e,i,r,a,n=255){var o=4*t+4*e*this.width;return Math.abs(this.data[o]-i)+Math.abs(this.data[o+1]-r)+Math.abs(this.data[o+2]-a)*n/255},u.prototype.setPixel=function(t,e,...i){
var r,a,n,o,[r,a,n,o]=Array.isArray(i[0])?i[0]:i,h=4*t+4*e*this.width;this.data[h]=r,this.data[h+1]=a,this.data[h+2]=n,this.data[h+3]=null==o?255:o},u.prototype.setPixelInt=function(t,e,i){var r=4*t+4*e*this.width;this.data[r]=i>>24&255,
this.data[r+1]=i>>16&255,this.data[r+2]=i>>8&255,this.data[r+3]=i>>0&255},u.prototype.toFileBytes=function(t,e){return"undefined"!=typeof HTMLCanvasElement?new Promise((i=>this.toImage().toBlob((t=>{var e=new FileReader;e.readAsArrayBuffer(t),
e.onload=()=>i(new Uint8Array(e.result))}),t,e))):b(this,t,e)},u.prototype.toPngBase64=function(){if("undefined"!=typeof HTMLCanvasElement){var t=this.toImage().toDataURL("image/png");return t.slice(t.indexOf(",")+1)}
throw new Error("synchronous image conversion not supported in nodejs, try using ImageData.prototype.toFileBytes")},u.prototype.pixelCompare=function(t,e=0,i=0,r){return dt(this,t,e,i,r)},u.prototype.copyTo=function(t,e,i,r,a,n,o){
const h=0|t.width,s=0|this.width,d=0|r,u=4*Math.floor(r/4),f=new Int32Array(this.data.buffer,this.data.byteOffset,this.data.byteLength/4),l=new Int32Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/4);for(let t=0;t<a;t++){
let r=0,a=r+n+(t+o)*h,c=r+e+(t+i)*s;for(;r<u;r+=4)l[a]=f[c],l[a+1]=f[c+1],l[a+2]=f[c+2],l[a+3]=f[c+3],a+=4,c+=4;for(;r<d;r++)l[a]=f[c],a+=1,c+=1}},
"undefined"!=typeof HTMLImageElement&&(HTMLImageElement.prototype.toBuffer=function(t=0,e=0,i=this.width,r=this.height){var a=document.createElement("canvas");a.width=i,a.height=r;var n=a.getContext("2d");return n.drawImage(this,-t,-e),
n.getImageData(0,0,i,r)},HTMLImageElement.prototype.toCanvas=function(t=0,e=0,i=this.width,r=this.height){var a=document.createElement("canvas");return a.width=i,a.height=r,a.getContext("2d").drawImage(this,-t,-e),a});var C=function(t,e,i,r){
return new(i||(i=Promise))((function(a,n){function o(t){try{s(r.next(t))}catch(t){n(t)}}function h(t){try{s(r.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,h)}
s((r=r.apply(t,e||[])).next())}))};class D extends Error{constructor(){super(),this.message="This method can not be ran outside of Alt1"}}class M extends Error{}var E="1.5.5",A="undefined"!=typeof alt1,R=A?alt1.skinName:"default",B=4e6;function L(t){
A?alt1.openBrowser(t):window.open(t,"_blank")}function P(){if(!A)throw new D}function O(){return!!A&&new d(alt1.screenX,alt1.screenY,alt1.screenWidth,alt1.screenHeight)}function S(...t){if(!A)throw new D;var e=d.fromArgs(...t)
;if(alt1.capture)return new u(alt1.capture(e.x,e.y,e.width,e.height),e.width,e.height);var i=new u(e.width,e.height);if(e.width*e.height*4<=B){if(!(n=alt1.getRegion(e.x,e.y,e.width,e.height)))return null;k(n,i,0,0,e.width,e.height)}else{
var r=e.x,a=alt1.bindRegion(e.x,e.y,e.width,e.height);if(a<=0)return null;for(;r<e.x+e.width;){var n,o=Math.min(e.x+e.width,Math.floor(r+B/4/e.height));if(!(n=alt1.bindGetRegion(a,r,e.y,o-r,e.height)))return null;k(n,i,r-e.x,0,o-r,e.height),r=o}}
return i}function U(t,e,i,r){t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),P();var a=alt1.bindRegion(t,e,i,r);if(a<=0)throw new M("capturehold failed");return new h(a,t,e,i,r)}function F(t,e,i,r){t=Math.round(t),e=Math.round(e),
i=Math.round(i),r=Math.round(r),P();var a=alt1.bindScreenRegion(t,e,i,r);return!(a<=0)&&new h(a,t,e,i,r)}function T(){return U(0,0,alt1.rsWidth,alt1.rsHeight)}function j(t,e,i,r,a){if(e=Math.round(e),i=Math.round(i),r=Math.round(r),a=Math.round(a),
P(),alt1.bindGetRegionBuffer)return new u(alt1.bindGetRegionBuffer(t,e,i,r,a),r,a);for(var n=new u(r,a),o=e;;){var h=Math.min(e+r,Math.floor(o+B/4/a)),s=alt1.bindGetRegion(t,o,i,h-o,a);if(!s)throw new M;if(k(s,n,o-e,0,h-o,a),(o=h)==e+r)break}return n
}function k(t,e,i,r,a,n){var o=atob(t),h=e.data;a|=0,n|=0;for(var s=4*i+4*r*e.width,d=0|e.width,u=0;u<a;u++)for(var f=0;f<n;f++){var l=s+(4*u|0)+(f*d*4|0)|0,c=(4*u|0)+(4*f*a|0)|0;h[l+0|0]=o.charCodeAt(c+2|0),h[l+1|0]=o.charCodeAt(c+1|0),
h[l+2|0]=o.charCodeAt(c+0|0),h[l+3|0]=o.charCodeAt(c+3|0)}return e}function N(t,e=0,i=0,r=t.width,a=t.height){for(var n="",o=i;o<i+a;o++)for(var h=e;h<e+r;h++){var s=4*h+4*t.width*o|0;n+=String.fromCharCode(t.data[s+2|0]),
n+=String.fromCharCode(t.data[s+1|0]),n+=String.fromCharCode(t.data[s+0|0]),n+=String.fromCharCode(t.data[s+3|0])}return btoa(n)}function H(t,e,i,r=255){return(i<<0)+(e<<8)+(t<<16)+(r<<24)}function q(t){return[t>>16&255,t>>8&255,t>>0&255]}
function z(t){A&&alt1.identifyAppUrl(t)}function G(){A="undefined"!=typeof alt1,R=A?alt1.skinName:"default"}var W=-1;function J(t){return!!A&&(-1==W&&(W=alt1.versionint),W>=function(t){var e=t.match(/^(\d+)\.(\d+)\.(\d+)$/)
;if(!e)throw new RangeError("Invalid version string");return 1e3*+e[1]*1e3+1e3*+e[2]+1*+e[3]}(t))}function V(){var t=alt1.mousePosition;return-1==t?null:{x:t>>>16,y:65535&t}}function _(t,e,i,r,a){
A&&alt1.userResize&&t.addEventListener("mousedown",(function(t){alt1.userResize(e,i,r,a),t.preventDefault()}))}function Y(t,e){A&&(alt1.events||(alt1.events={}),alt1.events[t]||(alt1.events[t]=[]),alt1.events[t].push(e))}function $(t,e){
var i=A&&alt1.events&&alt1.events[t];if(i){var r=i.indexOf(e);-1!=r&&i.splice(r,1)}}function K(t,e){var i=r=>{$(t,i),e(r)};Y(t,i)}class X{constructor(t,...e){this.framebuffer=null,this.pos=0,this.reading=!1,this.closed=!1,this.pausedindex=-1,
this.pausedbuffer=null,this.streamreader=t,e[0]instanceof u?this.setFrameBuffer(e[0]):"number"==typeof e[0]&&this.setFrameBuffer(new u(e[0],e[1]))}setFrameBuffer(t){if(this.reading)throw new Error("can't change framebuffer while reading")
;this.framebuffer=t}close(){this.streamreader.cancel()}nextImage(){return C(this,void 0,void 0,(function*(){if(this.reading)throw new Error("already reading from this stream");if(!this.framebuffer)throw new Error("framebuffer not set")
;this.reading=!0;Date.now(),Date.now();for(var t=!1;!t;)if(-1!=this.pausedindex&&this.pausedbuffer)t=this.readChunk(this.pausedindex,this.framebuffer.data,this.pausedbuffer);else{Date.now();var e=yield this.streamreader.read();if(Date.now(),
e.done)throw new Error("Stream closed while reading");var i=e.value;t=this.readChunk(0,this.framebuffer.data,i)}return Date.now(),this.reading=!1,this.framebuffer}))}readChunk(t,e,i){t|=0;for(var r=0|e.length,a=this.pos,n=0|i.length;t<n;){
for(;t<n&&a<r&&(a%16!=0||!((t+16|0)<=n&&(a+16|0)<=r));){var o=a;a%4==0&&(o=o+2|0),a%4==2&&(o=o-2|0),e[0|o]=i[0|t],t=t+1|0,a=a+1|0}if(a%16==0)for(;(t+16|0)<=n&&(a+16|0)<=r;)e[a+0|0]=i[t+2|0],e[a+1|0]=i[t+1|0],e[a+2|0]=i[t+0|0],e[a+3|0]=i[t+3|0],
e[a+4|0]=i[t+6|0],e[a+5|0]=i[t+5|0],e[a+6|0]=i[t+4|0],e[a+7|0]=i[t+7|0],e[a+8|0]=i[t+10|0],e[a+9|0]=i[t+9|0],e[a+10|0]=i[t+8|0],e[a+11|0]=i[t+11|0],e[a+12|0]=i[t+14|0],e[a+13|0]=i[t+13|0],e[a+14|0]=i[t+12|0],e[a+15|0]=i[t+15|0],a=a+16|0,t=t+16|0
;if(a>=r)return this.pausedbuffer=null,this.pausedindex=-1,this.pos=0,t!=i.length-1&&(this.pausedbuffer=i,this.pausedindex=t),!0}return this.pos=a,this.pausedbuffer=null,this.pausedindex=-1,!1}}function Q(...t){
return C(this,void 0,void 0,(function*(){P();var e=d.fromArgs(...t);if(alt1.captureAsync){let t=yield alt1.captureAsync(e.x,e.y,e.width,e.height);return new u(t,e.width,e.height)}if(!J("1.4.6"))return S(e.x,e.y,e.width,e.height)
;var i="https://alt1api/pixel/getregion/"+encodeURIComponent(JSON.stringify(Object.assign(Object.assign({},e),{format:"raw",quality:1}))),r=yield fetch(i);return new X(r.body.getReader(),e.width,e.height).nextImage()}))}function Z(t){
return C(this,void 0,void 0,(function*(){P();var e={};if(alt1.captureMultiAsync){let i=yield alt1.captureMultiAsync(t);for(let r in t)i[r]||(e[r]=null),e[r]=new u(i[r],t[r].width,t[r].height);return e}var i=[],r=[];for(var a in t)t[a]?(i.push(t[a]),
r.push(a)):e[a]=null;if(0==i.length)return e;if(J("1.5.1")){var n=yield fetch("https://alt1api/pixel/getregionmulti/"+encodeURIComponent(JSON.stringify({areas:i,format:"raw",quality:1}))),o=new X(n.body.getReader());for(d=0;d<i.length;d++){var h=i[d]
;o.setFrameBuffer(new u(h.width,h.height)),e[r[d]]=yield o.nextImage()}}else{for(var s=[],d=0;d<i.length;d++)s.push(Q(i[d]));for(var f=yield Promise.all(s),d=0;d<i.length;d++)e[r[d]]=f[d]}return e}))}function tt(t,e,i,r,a,n,o){if(P(),
!J("1.4.6"))throw new M("This function is not supported in this version of Alt1");var h="https://alt1api/pixel/streamregion/"+encodeURIComponent(JSON.stringify({x:t,y:e,width:i,height:r,fps:a,format:"raw"
})),s=(fetch(h).then((t=>C(this,void 0,void 0,(function*(){var e=new X(t.body.getReader(),i,r);try{for(;!e.closed&&!s.closed;){var a=yield e.nextImage();s.closed||(n(a),s.framenr++)}}catch(t){if(!s.closed){if(e.close(),!o)throw t;o(t)}}
!e.closed&&s.closed&&e.close()})))),{x:t,y:e,width:i,height:r,framenr:0,close:()=>{s.closed=!0},closed:!1});return s}var et=function(t,e,i,r){return new(i||(i=Promise))((function(a,n){function o(t){try{s(r.next(t))}catch(t){n(t)}}function h(t){try{
s(r.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,h)}s((r=r.apply(t,e||[])).next())}))};function it(t){return et(this,void 0,void 0,(function*(){
if("undefined"!=typeof Image){var e=new Image;return e.crossOrigin="crossorigin",yield new Promise(((i,r)=>{e.onload=function(){i(e.toBuffer())},e.onerror=r,e.src=t}))}var i="data:image/png;base64,";if(t.startsWith(i))return rt(t.slice(22))
;throw new Error("loading remote images in nodejs has been disabled, load the raw bytes and use imageDataFromNodeBuffer instead")}))}function rt(t){return et(this,void 0,void 0,(function*(){
return"undefined"!=typeof Image?it("data:image/png;base64,"+t):x(t)}))}function at(t){return et(this,void 0,void 0,(function*(){if(ot(t),"undefined"!=typeof Image){let e=new Blob([t],{type:"image/png"}),i=URL.createObjectURL(e),r=yield it(i)
;return URL.revokeObjectURL(i),r}return I(t)}))}function nt(t){return 137==t[0]&&80==t[1]&&78==t[2]&&71==t[3]}function ot(t){if(!nt(t))throw new Error("non-png image received");for(var e=8;e<t.length;){
var i=16777216*t[e++]+65536*t[e++]+256*t[e++]+t[e++],r=!!(t[e]>>5&1),a=String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3]);if("trns"!=a.toLowerCase()&&r){t[e+0]="n".charCodeAt(0),t[e+1]="o".charCodeAt(0),t[e+2]="P".charCodeAt(0),t[e+3]="E".charCodeAt(0)
;for(var n=e+4+i,o=4294967295,h=function(t){for(var e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;return t},s=e;s<n;s++){s>=e+4&&(t[s]=0),o=h(255&(o^t[s]))^o>>>8}o^=4294967295,t[e+4+i+0]=o>>24&255,t[e+4+i+1]=o>>16&255,t[e+4+i+2]=o>>8&255,
t[e+4+i+3]=o>>0&255}if("IEND"==a)break;e+=4,e+=i,e+=4}}function ht(t,e,i=0,r=0,a=t.width,n=t.height){if(!t)throw new TypeError;if(!e)throw new TypeError;if(t instanceof h&&A&&alt1.bindFindSubImg){
var o=N(e),s=alt1.bindFindSubImg(t.handle,o,e.width,i,r,a,n);if(!s)throw new M;return JSON.parse(s)}return st(t.read(),e,i,r,a,n)}function st(t,e,i=0,r=0,a=t.width,n=t.height){for(var o=[],h=4*e.width,s=4*t.width,d=[],u=0;u<e.height;u++){
for(var f=0;f<e.width;f++){var l=4*f+u*h;if(255==e.data[l+3]&&d.push({x:f,y:u}),10==d.length)break}if(10==d.length)break}var c=i+a-e.width,g=r+n-e.height,m=d.length;for(u=r;u<=g;u++)t:for(f=i;f<=c;f++){for(var w=0;w<m;w++){
var p=4*(f+d[w].x)+(u+d[w].y)*s,v=4*d[w].x+d[w].y*h,y=0;if(y=(y=(y=y+Math.abs(t.data[p+0]-e.data[v+0])|0)+Math.abs(t.data[p+1]-e.data[v+1])|0)+Math.abs(t.data[p+2]-e.data[v+2])|0,(y*=255/e.data[v+3])>30)continue t}if(dt(t,e,f,u,30)!=1/0&&(o.push({
x:f,y:u}),o.length>50))return o}return o}function dt(t,e,i,r,a=30){if(i<0||r<0)throw new RangeError;if(i+e.width>t.width||r+e.height>t.height)throw new RangeError;-1==a&&(a=1020)
;for(var n=0,o=8;o>=1;o/=2)for(var h=0;h<e.width;h+=o)for(var s=0;s<e.height;s+=o){var d=4*(i+h)+(r+s)*t.width*4,u=4*h+s*e.width*4,f=0
;if(f=(f=(f=f+Math.abs(t.data[d+0]-e.data[u+0])|0)+Math.abs(t.data[d+1]-e.data[u+1])|0)+Math.abs(t.data[d+2]-e.data[u+2])|0,f*=e.data[u+3]/255,1==o&&(n+=f),f>a)return 1/0}return n/e.width/e.height}function ut(t,e,i,r){if(i<0||r<0)throw new RangeError
;if(i+e.width>t.width||r+e.height>t.height)throw new RangeError;for(var a=0,n=0,o=0;o<e.width;o++)for(var h=0;h<e.height;h++){var s=4*(i+o)+(r+h)*t.width*4,d=4*o+h*e.width*4,u=0
;u=(u=(u=u+Math.abs(t.data[s+0]-e.data[d+0])|0)+Math.abs(t.data[s+1]-e.data[d+1])|0)+Math.abs(t.data[s+2]-e.data[d+2])|0;var f=e.data[d+3]/255;n+=f,a+=u*u*f}return Math.sqrt(a/n)}function ft(t,e,i,r,a,n,o){
return(Math.abs(t-r)+Math.abs(e-a)+Math.abs(i-n))*o/255}function lt(t){var e={},i=[];for(var r in t)t.hasOwnProperty(r)&&(e[r]=null,i.push(t[r].then(function(t,i){e[t]=i,a[t]=i}.bind(null,r))));var a={},n=Promise.all(i).then((()=>(a.loaded=!0,a)))
;return Object.defineProperty(a,"loaded",{enumerable:!1,value:!1,writable:!0}),Object.defineProperty(a,"promise",{enumerable:!1,value:n}),Object.defineProperty(a,"raw",{enumerable:!1,value:e}),Object.assign(a,e)}function ct(t){return lt(t)}class gt{
constructor(){this.buffers=[]}matchBest(t,e,i,r){let a=null,n=r;for(let r=0;r<this.buffers.length;r++){let o=t.pixelCompare(this.buffers[r],e,i,n);isFinite(o)&&(null==n||o<n)&&(n=o,a=r)}return null==a?null:{index:a,score:n}}static fromFilmStrip(t,e){
if(t.width%e!=0)throw new Error("slice size does not fit in base img");let i=new gt;for(let r=0;r<t.width;r+=e)i.buffers.push(t.clone(new d(r,0,e,t.height)));return i}static fromFilmStripUneven(t,e){let i=new gt,r=0
;for(let a of e)if(i.buffers.push(t.clone(new d(r,0,a,t.height))),r+=a,r>t.width)throw new Error("sampling filmstrip outside bounds");if(r!=t.width)throw new Error("unconsumed pixels left in film strip imagedata");return i}static fromAtlas(t,e){
let i=new gt;for(let r of e)i.buffers.push(t.clone(r));return i}}var mt=[],wt=!1,pt=!1,vt=!1,yt=null;function bt(t,e,i){mt.push({cb:t,error:e}),wt||Et(),i&&!pt&&Mt()}function xt(t){let e=mt.findIndex((e=>e.cb==t));-1!=e&&mt.splice(e,1)}
function It(t){for(var e in yt=t,mt)mt[e].cb(yt)}function Ct(t){vt=!1;let e=t instanceof HTMLCanvasElement?t:t.toCanvas();It(new o(e))}function Dt(t,e){var i,r;for(var a in vt=!1,mt)null===(r=(i=mt[a]).error)||void 0===r||r.call(i,e,t)}function Mt(){
window.addEventListener("dragover",(function(t){t.preventDefault()})),window.addEventListener("drop",(function(t){if(t.dataTransfer){var e=function(t){for(var e="",i=0;i<t.length;i++){var r=t[i],a=r.type.match(/^image\/(\w+)$/);if(a){
if("png"==a[1])return r;e=a[1]}}return e&&Dt("notpng","The image you uploaded is not a .png image. Other image type have compression noise and can't be used for image detection."),null}(t.dataTransfer.items);t.preventDefault(),e&&Rt(e.getAsFile())}
}))}function Et(){if(!wt){wt=!0;var t=!!navigator.userAgent.match(/Chrome/)&&!navigator.userAgent.match(/Edge/),e=function(t){if(t.clipboardData)for(var e=0;e<t.clipboardData.items.length;e++)if(-1!=t.clipboardData.items[e].type.indexOf("image")){
var i=t.clipboardData.items[e].getAsFile(),r=new Image;r.src=(window.URL||window.webkitURL).createObjectURL(i),r.width>0?Ct(r):r.onload=function(){Ct(r)}}};if(t)document.addEventListener("paste",e);else{var i=document.createElement("div")
;i.setAttribute("contenteditable",""),i.className="forcehidden",i.onpaste=function(t){t.clipboardData&&t.clipboardData.items?e(t):setTimeout((function(){var t=i.children[0];if(t&&"IMG"==t.tagName){var e=new Image;e.src=t.src
;e.src.match(/^data:([\w\/]+);/);e.width>0?Ct(e):e.onload=function(){Ct(e)},i.innerHTML=""}}),1)},document.body.appendChild(i)}document.addEventListener("keydown",(function(t){
"INPUT"!=t.target.tagName&&t.keyCode=="V".charCodeAt(0)&&t.ctrlKey&&(vt=!0,setTimeout((function(){vt&&Dt("noimg","You pressed Ctrl+V, but no image was pasted by your browser, make sure your clipboard contains an image, and not a link to an image.")
}),1e3),i&&i.focus())}))}}function At(){var t=document.createElement("input");return t.type="file",t.accept="image/png",t.onchange=function(){t.files&&t.files[0]&&Rt(t.files[0])},t.click(),t}function Rt(t){if(t){var e=new FileReader
;e.onload=function(){var t=new Uint8Array(e.result);nt(t)&&ot(t);var i=new Blob([t],{type:"image/png"}),r=new Image;r.onerror=()=>Dt("invalidfile","The file you uploaded could not be opened as an image.");var a=URL.createObjectURL(i);r.src=a,
r.width>0?(Ct(r),URL.revokeObjectURL(a)):r.onload=function(){Ct(r),URL.revokeObjectURL(a)}},e.readAsArrayBuffer(t)}}return e})()));
//# sourceMappingURL=index.bundle.js.map